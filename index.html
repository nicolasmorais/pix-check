<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout | Privacy Plus</title>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Lexend', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px 12px;
      color: #222;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .title {
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 12px;
    }

    .subtitle {
      color: #555;
      font-size: 0.95rem;
      margin-bottom: 12px;
    }

    .subtotal, .total {
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
      margin: 10px 0;
    }

    .label {
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      font-family: 'Lexend', sans-serif;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 16px;
      background: #00c158;
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    button:hover {
      background: #00a74e;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    .pix-area {
      display: none;
      margin-top: 24px;
      text-align: center;
    }

    #qrcode {
      width: 220px;
      height: 220px;
      margin: 0 auto;
      padding: 10px;
      background: white;
      border: 1px solid #eee;
    }

    #qrcode img {
      display: block;
      margin: 0 auto;
    }

    .pix-code {
      background: #f1f1f1;
      padding: 12px;
      border-radius: 6px;
      word-break: break-word;
      font-size: 0.95rem;
      font-family: monospace;
      position: relative;
    }

    .copy-btn {
      margin-top: 8px;
      padding: 10px;
      font-size: 0.95rem;
      background: #2382fb;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      color: white;
      width: 100%;
    }

    .confidential {
      background: #ffffff;
      padding: 12px;
      font-size: 0.9rem;
      color: #444;
      border-left: 4px solid #00b894;
      margin-bottom: 16px;
    }

    .review {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .review img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }

    .review strong {
      display: block;
      margin-bottom: 4px;
    }

    .stars {
      color: #ffcc00;
    }

    .secure {
      margin-top: 30px;
      text-align: center;
    }

    .logo {
      text-align: center;
      margin-bottom: 16px;
    }

    .logo img {
      width: 160px;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .payment-methods {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .payment-methods img {
      height: 30px;
    }

    .payment-confirmed {
      animation: fadeIn 0.5s ease-in-out;
      background: #e6f9f0;
      border-left: 4px solid #00c158;
      padding: 16px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #paymentPending {
      background: #fff8e1;
      border-left: 4px solid #ffc107;
      padding: 12px 16px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 0.95rem;
      color: #444;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGO -->
    <div class="logo">
      <img src="https://via.placeholder.com/160x60?text=Privacy+Plus" alt="Logo Privacy Plus">
    </div>

    <!-- CARRINHO -->
    <div class="card">
      <div class="title">Seu carrinho</div>
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
        <img src="https://via.placeholder.com/60" alt="Produto" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
        <div>
          <strong>Simaria Mendes | Privacy Plus</strong>
          <p style="margin: 4px 0; font-size: 0.85rem; color: #555;">Acesso sigiloso ao conte√∫do exclusivo.</p>
        </div>
      </div>
      <div class="subtotal">
        <span>Subtotal</span>
        <span>R$ 9,90</span>
      </div>
      <hr>
      <div class="total">
        <span class="label">Total</span>
        <span><strong id="totalValue">R$ 9,90</strong></span>
      </div>
    </div>

    <!-- IDENTIFICA√á√ÉO + PIX -->
    <div class="card">
      <div class="title">Identifica√ß√£o</div>
      <div class="confidential">
        üîí Esta compra √© 100% sigilosa e discreta. A descri√ß√£o no seu extrato banc√°rio ser√° gen√©rica, sem nomes ou t√≠tulos comprometedores.
      </div>

      <label for="email">Seu melhor e-mail</label>
      <input type="email" id="email" placeholder="Seu e-mail" required />

      <label for="nome">Seu nome completo</label>
      <input type="text" id="nome" placeholder="Nome completo" required />

      <button id="gerarPixBtn" onclick="gerarPix()">
        <svg xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 8px;" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path d="M4 13h4l-5 9V2h5l-4 11zm16-2h-4l5-9v20h-5l4-11z"/>
        </svg>
        GERAR PIX
      </button>

      <div class="pix-area" id="pix">
        <h3 style="font-size: 1.05rem; margin-bottom: 18px;">
          üîí Falta pouco! Para finalizar a compra, <br> escaneie o QR Code abaixo.
        </h3>

        <!-- Div onde o QR Code ser√° gerado -->
        <div id="qrcode"></div>

        <div class="total" style="margin-top: 10px; font-size: 1.1rem;">
          <span class="label">Valor:</span>
          <span><strong id="pixValue">R$ 9,90</strong></span>
        </div>

        <div class="pix-code" id="codigoPix">
          <!-- O c√≥digo Pix ser√° inserido aqui via JavaScript -->
        </div>

        <button class="copy-btn" onclick="copiarCodigo()">Copiar c√≥digo Pix</button>
        <p style="margin-bottom: 24px;">Copie o c√≥digo acima e pague no app <br> do seu banco via Pix.</p>

        <div class="payment-methods">
          <img src="https://logodownload.org/wp-content/uploads/2020/09/banco-do-brasil-logo-0.png" alt="Banco do Brasil">
          <img src="https://logodownload.org/wp-content/uploads/2018/08/nubank-logo-3.png" alt="Nubank">
          <img src="https://logodownload.org/wp-content/uploads/2019/08/itau-logo.png" alt="Ita√∫">
        </div>

        <div id="paymentStatus" style="background: #e6f9f0; border-left: 4px solid #00c158; padding: 12px 16px; border-radius: 8px; margin-top: 20px; font-size: 0.95rem; color: #222;">
          <strong>Como pagar com Pix:</strong>
          <div style="margin-top: 8px;">
            ‚úÖ 1. Abra o app do seu banco <br>
            ‚úÖ 2. Escolha a op√ß√£o "Pix com QR Code" <br>
            ‚úÖ 3. Escaneie e confirme o pagamento
          </div>
        </div>
      </div>

      <div id="paymentPending">
        ‚ö†Ô∏è Seu acesso est√° a um passo de ser conclu√≠do. Ap√≥s o pagamento, voc√™ receber√° o acesso imediato no seu e-mail.
      </div>

      <div id="paymentConfirmed" class="payment-confirmed" style="display: none;">
        <h3>‚úÖ Pagamento Confirmado!</h3>
        <p>Obrigado por sua compra! Voc√™ receber√° o acesso em instantes.</p>
        <p id="countdown">Redirecionando em 5 segundos...</p>
      </div>
    </div>

    <!-- AVALIA√á√ïES -->
    <div class="card">
      <div class="title">Avalia√ß√µes</div>
      <div class="review">
        <img src="https://via.placeholder.com/50" alt="Foto do Avaliador">
        <div>
          <strong>Gustavo Oliveira</strong>
          <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
          <p>Conte√∫do surpreendente e com total discri√ß√£o. Recomendo demais!</p>
        </div>
      </div>
      <div class="review">
        <img src="https://via.placeholder.com/50" alt="Foto do Avaliador">
        <div>
          <strong>Jo√£o Pereira</strong>
          <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</div>
          <p>√ìtima experi√™ncia, muito satisfeito com a compra.</p>
        </div>
      </div>
      <div class="review">
        <img src="https://via.placeholder.com/50" alt="Foto do Avaliador">
        <div>
          <strong>Ana Costa</strong>
          <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
          <p>Produto de qualidade e entrega r√°pida!</p>
        </div>
      </div>
    </div>

    <!-- RODAP√â -->
    <footer style="margin-top: 30px; padding: 20px; background: #ffffff; text-align: center; border-top: 1px solid #ccc;">
      <h3 style="font-size: 1.2rem; margin-bottom: 10px;">Pagamento Seguro</h3>
      <div class="payment-methods">
        <img src="https://logodownload.org/wp-content/uploads/2019/07/mastercard-logo.png" alt="Mastercard">
        <img src="https://logodownload.org/wp-content/uploads/2014/07/visa-logo-1.png" alt="Visa">
        <img src="https://logodownload.org/wp-content/uploads/2020/04/pix-logo-bcb-512.png" alt="PIX">
      </div>
      <p style="font-size: 0.95rem; margin-top: 10px;">Todos os dados s√£o criptografados e protegidos.</p>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script>
    // =============================================
    // CONFIGURA√á√ïES (ALTERE COM SEUS DADOS REAIS)
    // =============================================
    const TELEGRAM_BOT_TOKEN = '7717220778:AAGhzGVSyr0EGWi1y-XZzCFoaKWMvKz11lc';
    const TELEGRAM_CHAT_ID = '7717220778';
    const PUSHIN_PAY_API_KEY = '24474|uPLiDTQZoO4jSYHS5PY4HtjQgLWW5ykHSzJibthhbfa21725';
    const VALOR_PIX = 9.90;

    // =============================================
    // VARI√ÅVEIS GLOBAIS
    // =============================================
    let transactionId = null;
    let checkPaymentInterval = null;

    // =============================================
    // FUN√á√ïES PRINCIPAIS (CORRIGIDAS)
    // =============================================

    async function enviarParaTelegram(mensagem) {
      try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: mensagem,
            parse_mode: 'HTML'
          })
        });
        
        if (!response.ok) {
          const error = await response.json();
          console.error('Erro Telegram:', error.description);
          throw new Error('Falha ao enviar mensagem');
        }
      } catch (error) {
        console.error('Erro no Telegram:', error);
      }
    }

    async function gerarPix() {
      const email = document.getElementById('email').value.trim();
      const nome = document.getElementById('nome').value.trim();
      const btn = document.getElementById('gerarPixBtn');
      
      // Valida√ß√£o
      if (!email || !nome) {
        alert('Preencha todos os campos corretamente!');
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> GERANDO PIX...';

      try {
        // 1. Notificar Telegram
        await enviarParaTelegram(
          `üÜï <b>NOVA SOLICITA√á√ÉO DE PIX</b>\n\n` +
          `üë§ <b>Nome:</b> ${nome}\n` +
          `üìß <b>Email:</b> ${email}\n` +
          `üí∞ <b>Valor:</b> R$ ${VALOR_PIX.toFixed(2)}`
        );

        // 2. Gerar PIX na API
        const response = await fetch('https://api.pushinpay.com.br/api/pix/cashIn', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${PUSHIN_PAY_API_KEY}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            value: VALOR_PIX * 100,
            payer: { name: nome, email: email },
            metadata: { produto: "Privacy Plus" }
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Erro na API');
        }

        const data = await response.json();
        transactionId = data.id;

        // 3. Atualizar interface
        document.getElementById('codigoPix').textContent = data.qr_code;
        document.getElementById('pixValue').textContent = `R$ ${VALOR_PIX.toFixed(2)}`;
        
        // Gerar QR Code (m√©todo mais confi√°vel)
        QRCode.toDataURL(data.qr_code, { width: 200 }, (err, url) => {
          if (err) throw err;
          document.getElementById('qrcode').innerHTML = `<img src="${url}" alt="QR Code">`;
        });

        // Mostrar √°rea do PIX
        document.getElementById('pix').style.display = 'block';
        document.getElementById('paymentPending').style.display = 'block';

        // 4. Notificar sucesso
        await enviarParaTelegram(
          `‚úÖ <b>PIX GERADO COM SUCESSO</b>\n` +
          `ID: ${transactionId}\n` +
          `Cliente: ${nome}`
        );

        // 5. Iniciar verifica√ß√£o
        iniciarVerificacaoPagamento();

      } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao gerar Pix: ' + error.message);
        
        await enviarParaTelegram(
          `‚ùå <b>ERRO AO GERAR PIX</b>\n` +
          `Cliente: ${nome}\n` +
          `Erro: ${error.message}`
        );
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 8px;" width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M4 13h4l-5 9V2h5l-4 11zm16-2h-4l5-9v20h-5l4-11z"/></svg> GERAR PIX';
      }
    }

    async function verificarPagamento() {
      if (!transactionId) return;
      
      try {
        const response = await fetch(`https://api.pushinpay.com.br/api/transactions/${transactionId}`, {
          headers: { 'Authorization': `Bearer ${PUSHIN_PAY_API_KEY}` }
        });
        
        if (!response.ok) throw new Error('Falha na verifica√ß√£o');
        
        const data = await response.json();
        
        if (data.status === 'paid') {
          clearInterval(checkPaymentInterval);
          mostrarPagamentoAprovado();
          
          // Notificar confirma√ß√£o
          await enviarParaTelegram(
            `üí∞ <b>PAGAMENTO CONFIRMADO</b>\n` +
            `ID: ${transactionId}\n` +
            `Valor: R$ ${VALOR_PIX.toFixed(2)}`
          );
          
          iniciarRedirecionamento();
        }
      } catch (error) {
        console.error('Erro na verifica√ß√£o:', error);
      }
    }

    function iniciarVerificacaoPagamento() {
      if (checkPaymentInterval) clearInterval(checkPaymentInterval);
      checkPaymentInterval = setInterval(verificarPagamento, 5000);
      verificarPagamento(); // Verifica√ß√£o imediata
    }

    function mostrarPagamentoAprovado() {
      document.getElementById('paymentPending').style.display = 'none';
      const confirmed = document.getElementById('paymentConfirmed');
      confirmed.style.display = 'block';
      confirmed.scrollIntoView({ behavior: 'smooth' });
    }

    function iniciarRedirecionamento() {
      let seconds = 5;
      const countdown = document.getElementById('countdown');
      
      const timer = setInterval(() => {
        seconds--;
        countdown.textContent = `Redirecionando em ${seconds} segundos...`;
        
        if (seconds <= 0) {
          clearInterval(timer);
          window.location.href = 'https://seusite.com/obrigado';
        }
      }, 1000);
    }

    function copiarCodigo() {
      const codigo = document.getElementById('codigoPix').textContent;
      navigator.clipboard.writeText(codigo)
        .then(() => alert('C√≥digo copiado!'))
        .catch(() => alert('Erro ao copiar'));
    }

    // Debug
    window.addEventListener('error', (e) => {
      console.error('Erro n√£o tratado:', e.error);
    });
  </script>
</body>
</html>
